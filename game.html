<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>Play ‚Äî Punch's Great Escape üêí</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='58' r='34' fill='%23c47a2e'/><circle cx='50' cy='46' r='26' fill='%23c47a2e'/><ellipse cx='50' cy='52' rx='18' ry='16' fill='%23e8a96a'/><circle cx='43' cy='41' r='4.5' fill='%231a0a2e'/><circle cx='57' cy='41' r='4.5' fill='%231a0a2e'/><circle cx='38' cy='60' r='3.5' fill='%23ff4d6d'/></svg>"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Boogaloo&family=Nunito:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #050115;
        touch-action: none;
      }
      #game-wrap {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
      #cv {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        display: block;
        touch-action: none;
      }

      /* ‚îÄ‚îÄ HUD ‚îÄ‚îÄ */
      #hud {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        display: none;
        align-items: center;
        gap: clamp(4px, 0.8vw, 10px);
        padding: clamp(5px, 1vh, 9px) clamp(8px, 2vw, 16px);
        background: rgba(5, 1, 15, 0.75);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        z-index: 80;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }
      #hud.visible {
        display: flex;
      }
      #hud-hearts {
        font-size: clamp(12px, 2.2vw, 20px);
        white-space: nowrap;
        flex-shrink: 0;
        filter: drop-shadow(0 0 4px rgba(255, 77, 109, 0.8));
      }
      #hud-level {
        font-size: clamp(9px, 1.6vw, 13px);
        color: var(--teal);
        white-space: nowrap;
        flex-shrink: 0;
      }
      #hud-prog-wrap {
        flex: 1;
        height: 5px;
        min-width: 24px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
      }
      #hud-prog {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, var(--teal), var(--yellow));
        border-radius: 3px;
        transition: width 0.25s;
      }
      #hud-gems {
        font-size: clamp(9px, 1.5vw, 12px);
        color: var(--violet);
        white-space: nowrap;
        flex-shrink: 0;
      }
      #hud-score {
        font-size: clamp(9px, 1.6vw, 13px);
        color: var(--yellow);
        white-space: nowrap;
        flex-shrink: 0;
      }
      #hud-pause {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        font-size: clamp(10px, 1.6vw, 14px);
        cursor: pointer;
        border-radius: var(--r-sm);
        padding: 3px 8px;
        font-family: "Boogaloo", cursive;
        flex-shrink: 0;
      }

      /* ‚îÄ‚îÄ Top-right: coffee + mute ‚îÄ‚îÄ */
      #top-right {
        position: fixed;
        top: clamp(36px, 6.5vh, 52px);
        right: 10px;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 6px;
        z-index: 90;
      }
      #coffee-hud {
        background: rgba(255, 213, 79, 0.1);
        border: 1px solid rgba(255, 213, 79, 0.3);
        color: var(--yellow);
        font-size: clamp(8px, 1.3vw, 11px);
        font-family: "Boogaloo", cursive;
        border-radius: var(--r-pill);
        padding: 3px 10px;
        text-decoration: none;
        white-space: nowrap;
      }
      #coffee-hud:hover {
        background: rgba(255, 213, 79, 0.22);
      }
      #mute-hud {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        font-size: 13px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* ‚îÄ‚îÄ Mobile pause ‚Äî top LEFT, touch only ‚îÄ‚îÄ */
      #mob-pause {
        position: fixed;
        top: clamp(36px, 6.5vh, 52px);
        left: 10px;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.25);
        color: white;
        font-size: 15px;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 90;
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        -webkit-tap-highlight-color: transparent;
        pointer-events: all !important;
        z-index: 95;
      }
      #mob-pause.visible {
        display: flex;
      }

      /* ‚îÄ‚îÄ Status badges ‚îÄ‚îÄ */
      #immuno-badge {
        position: fixed;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(90deg, #7c3aed, #c084fc);
        color: white;
        padding: 2px 14px;
        font-size: clamp(10px, 1.6vw, 13px);
        border-radius: 0 0 12px 12px;
        display: none;
        z-index: 85;
        pointer-events: none;
        box-shadow: 0 4px 20px rgba(192, 132, 252, 0.6);
      }
      #magnet-badge {
        position: fixed;
        top: 0;
        right: 50%;
        transform: translateX(50%);
        background: linear-gradient(90deg, #db2777, #f472b6);
        color: white;
        padding: 2px 12px;
        font-size: clamp(10px, 1.6vw, 13px);
        border-radius: 0 0 10px 10px;
        display: none;
        z-index: 84;
        pointer-events: none;
      }
      #dev-badge {
        position: fixed;
        top: clamp(36px, 6.5vh, 52px);
        left: 52px;
        background: rgba(255, 77, 109, 0.15);
        border: 1px solid rgba(255, 77, 109, 0.4);
        color: var(--red);
        padding: 2px 8px;
        font-size: 10px;
        font-family: "Nunito", sans-serif;
        border-radius: 8px;
        z-index: 90;
        display: none;
      }
      #dev-badge.visible {
        display: block;
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TUTORIAL BAR ‚Äî slim strip just below HUD.
   NOT center screen. Just a top notification.
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      #tut-bar {
        position: fixed;
        top: clamp(36px, 6.5vh, 52px); /* sits right below HUD */
        left: 50%;
        transform: translateX(-50%);
        max-width: min(520px, 88vw);
        width: max-content;
        background: rgba(6, 2, 20, 0.94);
        border: 2px solid var(--orange);
        border-radius: var(--r-lg);
        padding: clamp(8px, 1.5vh, 14px) clamp(12px, 3vw, 24px);
        text-align: center;
        z-index: 92;
        pointer-events: none;
        display: none;
        animation: tutSlideDown 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow:
          0 0 30px rgba(255, 107, 53, 0.35),
          0 8px 32px rgba(0, 0, 0, 0.6);
      }
      #tut-bar.visible {
        display: block;
      }

      @keyframes tutSlideDown {
        from {
          opacity: 0;
          transform: translateX(-50%) translateY(-16px) scale(0.94);
        }
        to {
          opacity: 1;
          transform: translateX(-50%) translateY(0) scale(1);
        }
      }

      #tut-bar-icon {
        font-size: clamp(18px, 3.5vw, 28px);
        display: block;
        line-height: 1.1;
      }
      #tut-bar-text {
        font-family: "Nunito", sans-serif;
        font-size: clamp(12px, 2vw, 15px);
        color: rgba(255, 255, 255, 0.92);
        line-height: 1.4;
        display: block;
        margin: 2px 0;
      }
      #tut-bar-key {
        display: inline-block;
        background: rgba(255, 209, 102, 0.14);
        border: 1px solid rgba(255, 209, 102, 0.4);
        border-radius: 6px;
        padding: 2px 10px;
        font-size: clamp(10px, 1.6vw, 13px);
        color: var(--yellow);
        font-family: "Boogaloo", cursive;
        margin-top: 3px;
      }

      /* Tutorial arrow ‚Äî animated, points at obstacle */
      #tut-arrow {
        position: fixed;
        z-index: 93;
        font-size: clamp(28px, 6vw, 46px);
        pointer-events: none;
        display: none;
        filter: drop-shadow(0 0 10px var(--orange));
        animation: arrowPulse 0.45s ease-in-out infinite alternate;
        transform-origin: center bottom;
      }
      @keyframes arrowPulse {
        from {
          transform: translateX(-50%) translateY(0) scale(1);
          opacity: 0.9;
        }
        to {
          transform: translateX(-50%) translateY(-14px) scale(1.18);
          opacity: 1;
        }
      }

      /* ‚îÄ‚îÄ Level toast ‚îÄ‚îÄ */
      #level-toast {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        border: 2px solid var(--yellow);
        border-radius: var(--r-md);
        padding: 18px 36px;
        text-align: center;
        z-index: 95;
        pointer-events: none;
        display: none;
        backdrop-filter: blur(16px);
        min-width: clamp(180px, 48vw, 400px);
      }
      #toast-lvl {
        font-size: clamp(40px, 9vw, 68px);
        color: var(--yellow);
        line-height: 1;
      }
      #toast-name {
        font-size: clamp(14px, 3vw, 24px);
        color: rgba(255, 255, 255, 0.9);
        font-family: "Nunito", sans-serif;
      }
      #toast-desc {
        font-size: clamp(11px, 1.8vw, 15px);
        color: var(--teal);
        margin-top: 3px;
      }
      #toast-music {
        font-size: clamp(9px, 1.5vw, 12px);
        color: rgba(255, 255, 255, 0.38);
        margin-top: 3px;
        font-family: "Nunito", sans-serif;
        font-style: italic;
      }

      /* ‚îÄ‚îÄ Gem banner ‚îÄ‚îÄ */
      #gem-banner {
        position: fixed;
        top: clamp(42px, 8vh, 65px);
        left: 50%;
        transform: translateX(-50%);
        color: #1a0a2e;
        padding: 6px 20px;
        border-radius: var(--r-pill);
        font-size: clamp(11px, 1.8vw, 14px);
        font-family: "Nunito", sans-serif;
        font-weight: 700;
        z-index: 88;
        pointer-events: none;
        display: none;
        white-space: nowrap;
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.4);
      }
      #gem-banner.pop {
        display: block;
        animation: gemFlyIn 2.8s ease forwards;
      }
      @keyframes gemFlyIn {
        0% {
          opacity: 0;
          transform: translateX(-50%) translateY(-20px) scale(0.5);
        }
        15% {
          opacity: 1;
          transform: translateX(-50%) translateY(0) scale(1.1);
        }
        25% {
          transform: translateX(-50%) scale(1);
        }
        78% {
          opacity: 1;
        }
        100% {
          opacity: 0;
          transform: translateX(-50%) translateY(-15px) scale(0.85);
        }
      }

      /* ‚îÄ‚îÄ Screens ‚îÄ‚îÄ */
      .scr {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 16px;
        gap: 10px;
        overflow-y: auto;
        z-index: 70;
        background:
          radial-gradient(
            ellipse 80% 60% at 50% 110%,
            rgba(255, 107, 53, 0.16) 0%,
            transparent 65%
          ),
          linear-gradient(160deg, #080215 0%, #120630 55%, #1d0b45 100%);
      }
      .scr.active {
        display: flex;
      }

      #scr-pause {
        background: rgba(4, 1, 14, 0.92);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        gap: 14px;
      }
      #scr-pause h2 {
        font-size: clamp(28px, 7vw, 56px);
        color: var(--yellow);
      }
      #scr-pause p {
        color: var(--text-dim);
        font-family: "Nunito", sans-serif;
        font-size: var(--fs-sm);
        text-align: center;
      }
      #countdown {
        font-size: clamp(64px, 16vw, 110px);
        color: var(--orange);
        text-shadow: 0 0 50px rgba(255, 107, 53, 0.7);
        display: none;
        line-height: 1;
      }

      /* ‚îÄ‚îÄ Mobile controls ‚îÄ‚îÄ */
      #mob-ctrl {
        position: fixed;
        bottom: clamp(10px, 3vh, 24px);
        left: 0;
        right: 0;
        display: none;
        justify-content: space-between;
        align-items: flex-end;
        padding: 0 clamp(14px, 5vw, 36px);
        z-index: 82;
        pointer-events: none;
      }
      #mob-ctrl.visible {
        display: flex;
      }
      .mob-btn {
        width: clamp(60px, 16vw, 82px);
        height: clamp(60px, 16vw, 82px);
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.12);
        border: 2px solid rgba(255, 255, 255, 0.24);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(26px, 7vw, 36px);
        pointer-events: all;
        cursor: pointer;
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        transition:
          background 0.1s,
          transform 0.08s;
        -webkit-tap-highlight-color: transparent;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        user-select: none;
      }
      .mob-btn:active {
        background: rgba(255, 255, 255, 0.28);
        transform: scale(0.84);
      }

      /* ‚îÄ‚îÄ Score pops ‚îÄ‚îÄ */
      .score-pop {
        position: fixed;
        pointer-events: none;
        font-family: "Boogaloo", cursive;
        font-size: clamp(12px, 2.2vw, 17px);
        z-index: 77;
        animation: floatUp 0.9s ease-out forwards;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.6);
      }
      @keyframes floatUp {
        0% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
        100% {
          opacity: 0;
          transform: translateY(-60px) scale(1.4);
        }
      }

      /* Screen elements */
      #fail-title {
        font-size: clamp(24px, 5.5vw, 50px);
        line-height: 1.1;
        text-align: center;
      }
      .fail-msg {
        font-size: var(--fs-sm);
        color: rgba(255, 200, 100, 0.9);
        text-align: center;
        font-family: "Nunito", sans-serif;
        max-width: 360px;
      }
      #win-canvas {
        border-radius: var(--r-md);
        background: #050218;
        flex-shrink: 0;
        display: block;
      }
      .win-story {
        font-family: "Nunito", sans-serif;
        font-size: var(--fs-sm);
        color: rgba(255, 255, 255, 0.85);
        text-align: center;
        max-width: 400px;
        line-height: 1.75;
      }
    </style>
  </head>
  <body>
    <div id="game-wrap">
      <canvas id="cv"></canvas>

      <!-- HUD -->
      <div id="hud">
        <span id="hud-hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
        <span id="hud-level">LVL 1</span>
        <div id="hud-prog-wrap"><div id="hud-prog"></div></div>
        <span id="hud-gems">üíé 0</span>
        <span id="hud-score">0</span>
        <button id="hud-pause" onclick="togglePause()">‚è∏</button>
      </div>

      <!-- Top-right: coffee + mute -->
      <div id="top-right">
        <a
          id="coffee-hud"
          href="https://buymeacoffee.com/allanito"
          target="_blank"
          onclick="onCoffeeClick(event)"
          >‚òï Coffee</a
        >
        <button id="mute-hud" onclick="PunchAudio.toggleMute()">üîä</button>
      </div>

      <!-- Mobile pause button (top-left, touch only) -->
      <button id="mob-pause" onclick="togglePause()">‚è∏</button>

      <!-- Status badges -->
      <div id="immuno-badge">üõ°Ô∏è IMMUNE</div>
      <div id="magnet-badge">üß≤ MAGNET</div>
      <div id="dev-badge">üîß DEV</div>

      <!-- TUTORIAL ‚Äî slim top bar (NOT center screen) -->
      <div id="tut-bar">
        <span id="tut-bar-icon">‚¨ÜÔ∏è</span>
        <span id="tut-bar-text">Watch out!</span>
        <span id="tut-bar-key" style="display: none">SPACE / ‚Üë</span>
      </div>
      <!-- Animated arrow pointing at the demo obstacle -->
      <div id="tut-arrow">‚¨ÜÔ∏è</div>

      <!-- Level toast -->
      <div id="level-toast">
        <div id="toast-lvl">LEVEL 1</div>
        <div id="toast-name">üèõÔ∏è Monkey Zoo</div>
        <div id="toast-desc">Follow the tutorial!</div>
        <div id="toast-music"></div>
      </div>

      <!-- Gem pop banner -->
      <div id="gem-banner"></div>

      <!-- Mobile controls (bottom) -->
      <div id="mob-ctrl">
        <div
          class="mob-btn"
          id="mob-slide"
          ontouchstart="event.preventDefault();mobileSlide(true)"
          ontouchend="event.preventDefault();mobileSlide(false)"
        >
          ‚Üì
        </div>
        <div
          class="mob-btn"
          id="mob-jump"
          ontouchstart="event.preventDefault();mobileJump()"
        >
          ‚Üë
        </div>
      </div>

      <!-- PAUSE screen -->
      <div id="scr-pause" class="scr">
        <h2>‚è∏ PAUSED</h2>
        <p id="pause-sub">Tap Resume or press P / ESC</p>
        <div id="countdown"></div>
        <div
          style="
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
          "
        >
          <button class="btn btn-primary" onclick="resumeGame()">
            ‚ñ∂ Resume
          </button>
          <a
            href="index.html"
            class="btn btn-ghost"
            onclick="PunchGame.cleanUp()"
            >Main Menu</a
          >
        </div>
      </div>

      <!-- GAME OVER screen -->
      <div id="scr-over" class="scr">
        <h2 id="fail-title">üíÄ GOT CAUGHT</h2>
        <p class="fail-msg" id="fail-msg">The gang caught up‚Ä¶</p>
        <div class="stat-row">
          <div class="stat-box">
            <div class="sv" id="go-score">0</div>
            <div class="sl">Score</div>
          </div>
          <div class="stat-box">
            <div class="sv" id="go-level">1</div>
            <div class="sl">Level</div>
          </div>
          <div class="stat-box">
            <div class="sv" id="go-best">0</div>
            <div class="sl">Best</div>
          </div>
          <div class="stat-box">
            <div class="sv" id="go-maxlv">1</div>
            <div class="sl">Max LV</div>
          </div>
        </div>
        <div
          id="go-gems-info"
          style="
            font-size: var(--fs-xs);
            color: rgba(200, 180, 255, 0.8);
            font-family: Nunito, sans-serif;
            text-align: center;
          "
        ></div>
        <div
          id="continue-info"
          style="
            font-size: var(--fs-xs);
            color: var(--text-dim);
            font-family: Nunito, sans-serif;
            text-align: center;
          "
        ></div>
        <div
          style="
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
          "
        >
          <button
            class="btn btn-teal"
            id="cont-btn"
            onclick="PunchGame.continueRun()"
          >
            Continue ‚ù§Ô∏è
          </button>
          <button class="btn btn-red" onclick="PunchGame.restart()">
            Restart üîÑ
          </button>
          <button class="btn btn-share" onclick="PunchGame.share('over')">
            üì§ Share
          </button>
        </div>
        <a href="index.html" class="btn btn-ghost" onclick="PunchGame.cleanUp()"
          >Main Menu</a
        >
      </div>

      <!-- WIN screen -->
      <div id="scr-win" class="scr">
        <h2
          style="
            font-size: clamp(20px, 5vw, 46px);
            color: var(--teal);
            text-shadow: 0.06em 0.06em 0 #028a66;
            text-align: center;
          "
        >
          üß∏ PLUSHIE RECLAIMED!
        </h2>
        <canvas id="win-canvas" width="320" height="150"></canvas>
        <p class="win-story">
          Punch ran through jungles, storms, lava and chaos‚Ä¶<br />
          and he finally made it home. He curled up with the plushie.<br />
          <strong style="color: var(--yellow)">Finally at peace. üíõ</strong>
        </p>
        <div class="stat-row">
          <div class="stat-box">
            <div class="sv" id="win-score">0</div>
            <div class="sl">Score</div>
          </div>
          <div class="stat-box">
            <div class="sv" id="win-time">0s</div>
            <div class="sl">Time</div>
          </div>
          <div class="stat-box">
            <div class="sv" id="win-gems">0</div>
            <div class="sl">Gems</div>
          </div>
        </div>
        <div
          style="
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
          "
        >
          <button class="btn btn-share" onclick="PunchGame.share('win')">
            üì§ Share Victory!
          </button>
          <button class="btn btn-primary" onclick="PunchGame.restart()">
            Play Again üêí
          </button>
        </div>
      </div>
    </div>

    <script src="game.js"></script>
    <script>
      window.addEventListener("load", () => PunchGame.init());
      function togglePause() {
        PunchGame.togglePause();
      }
      function resumeGame() {
        PunchGame.resume();
      }
      function onCoffeeClick(e) {
        if (PunchGame && PunchGame.state === "playing") PunchGame.autoPause();
      }
      function mobileJump() {
        PunchAudio.wake();
        PunchGame.doJump();
      }
      function mobileSlide(active) {
        PunchGame.setSlide(active);
      }
    </script>
  </body>
</html>
